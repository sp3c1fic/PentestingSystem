using Microsoft.AspNetCore.Mvc;
using Microsoft.Extensions.DependencyInjection;
using PentestingSystem.Core.Contracts;

namespace PentestingSystem.Core.Services;

public class BadRequestConfig: IBadRequestConfig
{
    public IMvcBuilder AddBadRequestServices(IMvcBuilder services)
    {
        services.ConfigureApiBehaviorOptions(opt => 
            opt.InvalidModelStateResponseFactory = actionContext =>
            {
                var modelState = actionContext.ModelState.Values;
                var allErrors = actionContext.ModelState.Values
                    .SelectMany(v => v.Errors);

                return new BadRequestObjectResult(new
                {
                    StatusCode = 400,
                    Message = string.Join(" - ", allErrors.Select(e => e.ErrorMessage))
                });

            });

        return services;
    }
}