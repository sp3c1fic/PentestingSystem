
using DnsClient;
using Microsoft.AspNetCore.Mvc;
using PentestingSystem.Core.Contracts;
using PentestingSystem.Models.DNS;

namespace PentestingSystem.Controllers;

public class DNSLookupController : Controller 
{   
    private readonly IDnsRecordService _dnsRecordService;

    public DNSLookupController(IDnsRecordService dnsRecordService)
    {
        _dnsRecordService = dnsRecordService;
    }

    public IActionResult Index()
    {
        var model = new DNSLookupFormModel();
        
        return View(model);
    }
    
    [HttpPost]
    public async Task<IActionResult> FetchDnsRecords(string domain, string recordType)
    {
        var lookupClient = new LookupClient();
        var records = await _dnsRecordService.GetDnsRecords(lookupClient, "google.com", "MX");

        var model = new DnsRecordServiceModel
        {
            Records = records
        };

        return PartialView("_DNSLookupResults", model);
    }
}