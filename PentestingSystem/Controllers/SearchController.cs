using Microsoft.AspNetCore.Authorization;
using Microsoft.AspNetCore.Mvc;
using PentestingSystem.Core.Contracts;

namespace PentestingSystem.Controllers;

[Authorize]
[ApiController]
[Route("api/[controller]")]
public class SearchController : Controller
{
    private readonly ISearchContentService _searchContentService;
    private readonly ICategoryService _categoryService;

    public SearchController(ISearchContentService searchContentService, ICategoryService categoryService)
    {
        _searchContentService = searchContentService;
        _categoryService = categoryService;
    }

    [HttpGet]
    public async Task<IActionResult> SearchContent([FromQuery] string searchPattern)
    { if (string.IsNullOrEmpty(searchPattern) || searchPattern == "undefined")
        {
            var allToolsCategories = await _categoryService.GetCategories();
            return Ok(allToolsCategories);
        }
 
        var searchResult = await _searchContentService.FetchContent(searchPattern);
        return Ok(searchResult);
    }
}