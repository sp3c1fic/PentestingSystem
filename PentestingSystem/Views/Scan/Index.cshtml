@model ScanFormModel

@{
    ViewBag.Title = "title";
    Layout = "_Layout";
}
<style>
    .scan-div {
        height: 580px;
        background: rgba(0,0,0,0.5);
        overflow: scroll;
        border: 1px solid black;
        border-radius: 5px;
        box-shadow: 0px 0px 10px 5px rgba(0, 0, 0, 0.5);
    }
    
    
    .description {
        margin: auto;
    }
    
    .scan-options:hover {
        cursor: pointer;
    }
    
            body {
                font-family: Arial, sans-serif;
                background-color: #0a0e10;;
            }
    
            h1 {
                color: #333;
                text-align: center;
                margin-bottom: 20px;
            }
                
            .load-spinner .spinner-container img {
                width: 50px; /* Adjust the width of the loading spinner */
            }
            
            .load-spinner .spinner-container p {
                margin-top: 10px;
                font-weight: bold;
            }
            
            
            /* Fading Effect for Loading Spinner */
            .show-spinner .load-spinner {
                display: block !important; /* Display the loading spinner */
            }
        
            .load-spinner img {
                width: 50px; /* Adjust the width of the loading spinner */
            }
    
            .load-spinner p {
                margin-top: 10px;
                font-weight: bold;
            }
            
            .scan-select {
                display: flex;
                justify-content: center;
            }
            
            select {
                margin:  auto;
            }   
         .tools {
             border: 2px solid white;
             border-radius: 5px;
             box-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.2), 0 6px 20px 0 rgba(0, 0, 0, 0.19);
         }
         
         .tools-section {
             width: 91%;
             margin: auto;
             position: relative;
             left: 35px;
         }
</style>

<div class="text-center scan-div mt-5">
    <div class="mt-5">
        <h2 class="text-warning">NMAP Online scanner</h2>
        <p class="text-white"><strong>Enter domain name or IP address and select scan method. After the scan finishes you get Nmap scan result for your target.</strong></p>
        <p class="text-light"> Some firewalls blocks Nmap scans. In order to get true positive results add nmap.online IP addresses (91.214.64.186-91.214.64.187) to the whitelist </p>
    </div>
   
    <form id="scanForm" method="post">
        <label asp-for="Target" class="text-light"></label>
        <div class="form- scan-select mb-3">
            <input asp-for="@Model.Target" class="input-field w-75 host-input-field" type="text" style="height: 38px" placeholder="Enter Domain or IP to scan ..." required>
            <button id="scan-btn" class="btn btn-danger" type="submit" asp-controller="Scan" asp-action="Scan">Scan <i class="fa fa-angle-double-right" aria-hidden="true"></i></button>
            <span asp-validation-for="@Model.Target" class="text-danger"></span>
        </div>
        <div class="input-container">
            <h5 class="text-white scan-options" id="scan-options"> Scan Options: Fast Scan of Target with an Normal output. <em class="text-decoration-underline text-warning">Change Options</em> </h5>
        </div>
        <div class="d-none" id="scan-menu">
            <p class="text-white">Select scan below</p>
            <div class="form-group">
                <select asp-for="@Model.ScanCommandId" class="form-control w-50 tools-section" id="exampleFormControlSelect1">
                    @foreach (var scanCommand in Model.ScanCommands)
                    {
                        <option asp-for="@Model.ScanCommandId" value="@scanCommand.Id">@scanCommand.Name</option>
                    }
                </select>
            </div>

        </div>
    </form>
    <div id="loadingSpinner" style="display: none" class="text-light mt-5">
        <i class="fa fa-spinner fa-spin"></i> Scanning ...
    </div>
        
    @await Html.PartialAsync("_ScanResults", new ScanServiceModel())
    <div class="w-75 description mt-5 text-center">
        <h4 class="text-white"><i class="fa fa-circle-o-notch text-primary" aria-hidden="true"></i> <strong>Nmap</strong></h4>
        <p class="tool-description text-warning bg-transparent">Nmap is a free and open-source network scanner. Nmap is used to discover hosts and services on a computer network by sending packets and analyzing the responses.
            Nmap provides a number of features for probing computer networks, including host discovery and service and operating system detection. These features are extensible by scripts that provide more advanced service detection, vulnerability detection, and other features. Nmap can adapt to network conditions including latency and congestion during a scan.</p>
    </div>
</div>
    

<partial name="_RelatedTools"/>
<partial name="_ScannerInfo" />

<script
    src="https://code.jquery.com/jquery-3.7.1.js"
    integrity="sha256-eKhayi8LEQwp4NKxN+CfCh+3qOVUtJn3QNZ0TciWLP4="
    crossorigin="anonymous">
</script>

<!-- Move the code below to a separate js file -->

<script>
    const element = document.getElementById('scan-options');
    const scanMenu = document.getElementById('scan-menu');
    
    element.addEventListener('click', () => {
         if (scanMenu.classList.contains("d-none")) {
                scanMenu.classList.remove("d-none");
                scanMenu.classList.add('d-block');
         }
         else if (scanMenu.classList.contains("d-block")) {
             scanMenu.classList.remove("d-block");           
             scanMenu.classList.add('d-none');
         }
           
    });
    
    $(document).ready(function () {
        $('#scanResults').hide();    
        $('#scanForm').submit(function (event) {
            event.preventDefault();
            $('#scanResults').hide()
            
            const hostInputField = $('.host-input-field');
            console.log(hostInputField[0].value);
            
            if (hostInputField[0].value === "" || 
                hostInputField[0].value === undefined || 
                hostInputField[0].value === null){
                    console.log(`value of host cannot be empty or null`);
                    alert('Host must not be empty');   
                    return;
            }
            
            const pattern = "^([a-z0-9]+(-[a-z0-9]+)*\.)+[a-z]{2,}|(?:[0-9]{1,3}\.){3}[0-9]{1,3}$";
            const re = new RegExp(pattern);
            
            if (!re.test(hostInputField[0].value)){
                alert("Invalid hostname/IPv4 format.");
                return;
            }
            
            $('#loadingSpinner').show();
            
            $.ajax({
            
                  url: 'http://localhost:5052/Scan/Scan/',
                  observe: "response",
                  headers: {
                        'Access-Control-Allow-Origin': '*'
                  },
                  type: 'POST',
                  crossDomain: true,
                  data: $(this).serialize(),
                  success: function(data) { 
                    $('#loadingSpinner').hide();
                    $('#scanResults').html(data).show();
                    return -1;
                  },
                  error: function() {
                    $('#loadingSpinner').hide();
                    console.log("error");
                  }
            });
          
        });
    });
       
            
            

</script>